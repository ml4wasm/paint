<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>ml4wasm paintings</title>

    <style>
    :root {
		--main-font: Arial;
		--dark-blue: darkblue;
		--black: black;
		--blue: blue;
		--grey: grey;
		--dim-grey: dimgrey;
		--transform: scale(1.02) translate(0px, 2px) skew(1deg, 0deg);
		--base-size: 25px;
		--zero: 0;
		--two: 2px;
		--trans: transparent;
		--twenty-one: 21px;
		--ten: 10px;
		--three: 3px;
		--one: 1px;
		--twenty-three: 23px
	}
    textarea {
    		margin-top: var(--zero);
    		margin-bottom: var(--ten);
    		height: 150px;
    		font-family: var(--main-font);
    		font-size: var(--base-size);
    		border-radius: var(--two);
    		padding-left: 1px;
    		padding-right: var(--zero);
    		width: 400px;
    		margin-bottom: var(--ten);
    		transition: .5s
    	}
      textarea:hover{
		box-shadow: 0 0 5px var(--black);
		border-radius: var(--three)
	}
    </style>
  </head>
  <body>


<textarea id="place" placeholder="Type text to encode here."></textarea><button onclick="changeText()" id="placer"> generate image </button>

<canvas id="myCanvas" width="400" height="400">

<script>
var worker = new Worker('worker.js');
var wasm = new Worker('wasm.js');
var text = new Worker('text.js');
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
var mImgData = ctx.createImageData(400, 400);


function changeText(){
a1 = document.getElementById("place").value;
text.postMessage(a1);
text.onmessage = function (message){
var weights = message.data;


worker.onmessage = function (e) {

wasm.postMessage([e.data,weights]);

  wasm.onmessage = function(z){
  var send = z.data;
  send.length= 640000;
  var srcIndex=0, dstIndex=0, curPixelNum=0;

  	for (curPixelNum=0; curPixelNum<400*400;  curPixelNum++){
  		mImgData.data[dstIndex] = send[srcIndex];		// r
  		mImgData.data[dstIndex+1] = send[srcIndex+1];	// g
  		mImgData.data[dstIndex+2] = send[srcIndex+2];	// b
  		mImgData.data[dstIndex+3] = 255; // 255 = 0xFF - constant alpha, 100% opaque
  		srcIndex += 3;
  		dstIndex += 4;
  	}
    console.log(mImgData);
    ctx.putImageData(mImgData, 0, 0);
  }

  }
}

}

</script>
  </body>
</html>
