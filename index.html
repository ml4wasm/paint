<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
  <input id="place" placeholder="Type text to encode here."> <button onclick="changeText()" id="placer"> encode </button>
  <canvas id="myCanvas" width="400" height="400">
<script>
var worker = new Worker('worker.js');
var wasm = new Worker('wasm.js');
var text = new Worker('text.js');
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
var mImgData = ctx.createImageData(400, 400);


function changeText(){
a1 = document.getElementById("place").value;
text.postMessage(a1);
text.onmessage = function (message){
var weights = message.data;


worker.onmessage = function (e) {

wasm.postMessage([e.data,weights]);

  wasm.onmessage = function(z){
  var send = z.data;
  send.length= 640000;
  var srcIndex=0, dstIndex=0, curPixelNum=0;

  	for (curPixelNum=0; curPixelNum<400*400;  curPixelNum++){
  		mImgData.data[dstIndex] = send[srcIndex];		// r
  		mImgData.data[dstIndex+1] = 0 //send[srcIndex+1];	// g
  		mImgData.data[dstIndex+2] = 0 //send[srcIndex+2];	// b
  		mImgData.data[dstIndex+3] = 255; // 255 = 0xFF - constant alpha, 100% opaque
  		srcIndex += 3;
  		dstIndex += 4;
  	}
    ctx.putImageData(mImgData, 0, 0);
  }

  }
}

}

</script>
  </body>
</html>
